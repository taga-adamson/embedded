<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flood Monitoring Map</title>

  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
    }

    #map {
      position: relative;
      width: 1012px;
      height: 568px;
      margin: auto;
      background: url("EMBED-GUI.png") no-repeat center;
      background-size: contain;
    }

    .street {
      position: absolute;
      opacity: 0.6;
      border: 2px solid black;
    }

    .safe { background: #00ff00; }
    .moderate { background: #ff9900; }
    .extreme {
      background: red;
      animation: blink 0.8s infinite alternate;
    }

    @keyframes blink {
      from { opacity: 0.4; }
      to   { opacity: 0.9; }
    }

    #panel {
      position: absolute;
      right: 30px;
      top: 140px;
      width: 280px;
      background: black;
      border: 2px solid white;
      padding: 10px;
    }
  </style>
</head>

<body>

<div id="map">

  <!-- ROADS (POSITIONED MANUALLY) -->
  <div id="zobel" class="street" style="left:280px; top:170px; width:330px; height:25px;"></div>
  <div id="san_marcelino" class="street" style="left:250px; top:140px; width:25px; height:360px;"></div>
  <div id="romualdez" class="street" style="left:490px; top:200px; width:25px; height:300px;"></div>
  <div id="un_ave" class="street" style="left:50px; top:500px; width:550px; height:25px;"></div>

  <!-- WARNING PANEL -->
  <div id="panel">
    <b>‚ö† STREET WARNINGS</b>
    <div id="warn-zobel"></div>
    <div id="warn-san"></div>
    <div id="warn-rom"></div>
    <div id="warn-un"></div>
  </div>

</div>

<!-- ‚úÖ FIREBASE + LOGIC -->
<script type="module">

  // üî• IMPORT FIREBASE SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // üî• YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyA-D-TEQ9Gq5F35or-DpBqyLUqVvxtqHLA",
    authDomain: "floodmonitoringsystem-7720f.firebaseapp.com",
    databaseURL: "https://floodmonitoringsystem-7720f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "floodmonitoringsystem-7720f",
    storageBucket: "floodmonitoringsystem-7720f.firebasestorage.app",
    messagingSenderId: "666441156096",
    appId: "1:666441156096:web:7bc9c171b9356729bcfae5"
  };

  // üî• INITIALIZE
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // üîÅ SENSOR ‚Üí LEVEL
  function level(adc) {
    if (adc < 1000) return "safe";
    if (adc < 2500) return "moderate";
    return "extreme";
  }

  function apply(id, lvl, label) {
    const el = document.getElementById(id);
    el.className = "street " + lvl;

    document.getElementById("warn-" + id.replace("_ave","").replace("_",""))
      .innerText =
        lvl === "extreme" ? `‚õî EXTREME ‚Äì ${label}` :
        lvl === "moderate" ? `‚ö† MODERATE ‚Äì ${label}` :
        `‚úî PASSABLE ‚Äì ${label}`;
  }

  // üî¥ REALTIME LISTENER
  onValue(ref(db, "water_level"), snap => {
    const d = snap.val();
    if (!d) return;

    apply("zobel", level(d.zobel.adc_value), "ZOBEL");
    apply("san_marcelino", level(d.san_marcelino.adc_value), "SAN MARCELINO");
    apply("romualdez", level(d.romualdez.adc_value), "ROMUALDEZ");
    apply("un_ave", level(d.un_ave.adc_value), "UN AVE");
  });

</script>

</body>
</html>
