<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flood Monitoring â€“ Campus Roads</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
    body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    h1 {
        margin: 10px;
    }

    #map {
    position: relative;
    width: 1012px;
    height: 568px;
    margin: auto;
    background-image: url("./EMBED-GUI.png");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    border: 2px solid #444;
}


    .road {
        position: absolute;
        opacity: 0.7;
        border: 2px solid black;
    }

    .safe { background: #00ff00; }
    .moderate { background: #ff9900; }
    .extreme {
        background: red;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0% { opacity: 0.9; }
        50% { opacity: 0.4; }
        100% { opacity: 0.9; }
    }

    #panel {
        margin-top: 10px;
        width: 350px;
        margin-left: auto;
        margin-right: auto;
        background: black;
        border: 2px solid white;
        padding: 10px;
    }

    .row {
        margin: 6px 0;
        font-weight: bold;
    }
</style>
</head>

<body>

<h1>ðŸš¦ Flood Monitoring â€“ Campus Roads</h1>

<div id="map">
    <!-- ROADS -->
    <div id="zobel" class="road" style="left:280px; top:170px; width:330px; height:25px;"></div>
    <div id="san_marcelino" class="road" style="left:250px; top:140px; width:25px; height:360px;"></div>
    <div id="romualdez" class="road" style="left:490px; top:195px; width:25px; height:300px;"></div>
    <div id="un_ave" class="road" style="left:50px; top:500px; width:550px; height:25px;"></div>
</div>

<div id="panel">
    <div class="row" id="zobel_txt">Zobel: Waiting...</div>
    <div class="row" id="san_txt">San Marcelino: Waiting...</div>
    <div class="row" id="rom_txt">Romualdez: Waiting...</div>
    <div class="row" id="un_txt">UN Ave: Waiting...</div>
</div>

<script>
/* ===============================
   ðŸ”¥ FIREBASE CONFIG
================================ */
const firebaseConfig = {
    apiKey: "AIzaSyA-D-TEQ9Gq5F35or-DpBqyLUqVvxtqHLA",
    databaseURL: "https://floodmonitoringsystem-7720f-default-rtdb.asia-southeast1.firebasedatabase.app"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===============================
   LOGIC
================================ */
function sensorToLevel(val) {
    if (val < 1000) return "safe";
    if (val < 2500) return "moderate";
    return "extreme";
}

function updateRoad(id, textId, val, name) {
    const level = sensorToLevel(val);
    const road = document.getElementById(id);

    road.className = "road " + level;

    const labels = {
        safe: "âœ” PASSABLE",
        moderate: "âš  MODERATE FLOOD",
        extreme: "â›” EXTREME FLOOD"
    };

    document.getElementById(textId).innerHTML =
        `${name}: ${labels[level]} <span style="color:#aaa">(${val})</span>`;
}

/* ===============================
   LISTENER
================================ */
db.ref("water_level").on("value", snap => {
    const d = snap.val();
    if (!d) return;

    updateRoad("zobel", "zobel_txt", d.zobel.adc_value, "Zobel");
    updateRoad("san_marcelino", "san_txt", d.san_marcelino.adc_value, "San Marcelino");
    updateRoad("romualdez", "rom_txt", d.romualdez.adc_value, "Romualdez");
    updateRoad("un_ave", "un_txt", d.un_ave.adc_value, "UN Ave");
});
</script>

</body>
</html>

